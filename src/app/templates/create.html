{% extends "base.html" %}

{% block title %}Create Plan{% endblock %}

{% block content %}
    <!-- This is to let jinja prepopulate the template with the existing plan data if it exists-->
  <script>
    window.INIT_PLAN = {
      name: {{ plan_name|tojson }},
      units: {{ grid_units|tojson }},
    };
  </script>

  <div class="w-full flex flex-row gap-10 h-[80vh]">
    <!-- Search Bar Side -->
    <div class="flex flex-col h-full rounded-lg bg-gray-200 border border-gray-600 dark:bg-dark-border w-[30%] p-5 gap-4">

      <!-- Prefill Unit Plan -->
      <div class="flex items-center gap-2 mb-4">
        <label for="prefillSelect" class="text-sm font-medium">Prefill template:</label>
        <select id="prefillSelect"
                class="px-3 py-2 border rounded bg-white dark:bg-dark-fg text-gray-900 dark:text-dark-primary">
          <option value="">— Select one —</option>
          <option value="cs">Computer Science</option>
          <option value="cyber">Cybersecurity</option>
        </select>
      </div>
      
      <!-- Search Unit -->
      <div class="w-full flex flex-row gap-4 transition-colors duration-300">
        <div>
          <select id="searchType" class="flex w-full px-4 py-3 rounded-lg border border-gray-200 dark:border-dark-border bg-gray-50 dark:bg-dark-fg text-gray-900 dark:text-dark-primary focus:outline-none focus:border-blue-500 dark:focus:border-blue-400 transition">
            <option value="name">Name</option>
            <option value="code">Unit Code</option>
          </select>
        </div>
        <div class="flex flex-col flex-grow" style="position: relative;">
          <input type="text" id="searchInput" placeholder="Filter units..." autocomplete="off"
            class="w-full px-4 py-3 rounded-lg border border-gray-200 dark:border-dark-border bg-gray-50 dark:bg-dark-fg text-gray-900 dark:text-dark-primary focus:outline-none focus:border-blue-500 dark:focus:border-blue-400 transition">
          <ul id="results" class="dropdown-list" style="width: 100%;"></ul>
        </div>
      </div>
      <div class="w-full border border-gray-600"></div>
      <div id="unitList" class="flex-grow overflow-auto"></div>
      <div class="flex flex-col w-full">
        <input type="text" id="planName" placeholder="Unit Plan Name" value="{{ plan_name }}"
          class="w-full px-4 py-3 rounded-lg border border-gray-200 dark:border-dark-border bg-gray-50 dark:bg-dark-fg text-gray-900 dark:text-dark-primary focus:outline-none focus:border-blue-500 dark:focus:border-blue-400 transition">
      </div>
      <div class="flex flex-row gap-4">
        <a href="{{ url_for('main.create_page') }}" class="px-4 py-2 bg-red-500 hover:bg-red-600 rounded-lg text-white text-sm transition">Clear</a>
        <div class="flex-grow"></div>
        <a id="saveButton" class="px-4 py-2 bg-green-500 hover:bg-green-600 rounded-lg text-white text-sm transition">Save</a>
      </div>
    </div>

    <!-- turned this into a loop to cut down on some lines of code -->
    <div class="flex h-full flex-grow grid gap-4" style="grid-template-columns: repeat(5, 20%); grid-template-rows: repeat(8, 10%);">
      {# Loop to generate year labels and slots dynamically #}
      {% for r in range(1,9) %}
        {% if r in [1,3,5,7] %}
          <div class="flex items-center justify-center border-2 col-start-1 row-start-{{ r }} row-span-2 rounded-lg bg-gray-200 dark:bg-dark-border year {{ ['border-purple-500','border-orange-500','border-pink-400','border-cyan-600'][((r-1)//2)] }}">
            Year {{ ((r-1)//2) + 1 }}
          </div>
        {% endif %}
        {% for c in range(2,6) %}
          <div class="border-2 col-start-{{ c }} row-start-{{ r }} rounded-lg bg-gray-200 dark:bg-dark-border unit-cell" data-key="{{ r }},{{ c-1 }}">
            {%- set cell = grid_units.get((r, c-1)) -%}
            {% if cell %}
              <div class="p-2 rounded text-center cursor-move text-xs unit" draggable="true">{{ cell.name }} ({{ cell.code }})</div>
            {% endif %}
          </div>
        {% endfor %}
      {% endfor %}
    </div>
    <script src="{{ url_for('static', filename='js/create.js') }}"></script>
{% endblock %}